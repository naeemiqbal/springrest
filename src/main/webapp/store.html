<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Stores</title>
<script type="text/javascript" src="nmiUtils.js"></script>
<link type="text/css" href="nmiStyles.css" rel="stylesheet" >
<style type="text/css" src="nmiStyles.css"  href="nmiStyles.css" ></style>

<script>
	window.addEventListener("DOMContentLoaded", loader);
	
	function loader() {
		var req = new XMLHttpRequest();
		req.open("GET", "/stores");
		req.onreadystatechange = resp;
		req.send();
                let bd = document.getElementsByTagName('body');
                /*if (bd)        
                    bd.addEventListener('load', addEvents);*/
                addEvents();
                document.addEventListener('change', (event) => {
    // Make sure, that you're receiving event from a correct element
    if (event.target.name === 'list') {
        addEvents();
    }
});
                
	}

	function resp(r, b, c) {
		var t, s;
		if (r) {
			t = r.target;
			if (t.readyState === 3 /*|| r.readyState === LOADING*/) {
				s = JSON.parse(t.responseText);
				document.getElementsByName("list")[0].innerHTML = getTable(s);
				document.getElementsByName("record")[0].innerHTML = getRecord(s);
				console.log(s);
				//document.getElementsByTagName("tr").addEventListener('click', loadRow);                                
			}
			console.log(t);
		}
	}
	
	function addEvents(a,b, c) {
            let tbl = document.querySelector("[name=listTable]");
/*            if (!tbl)              tbl=document.querySelector(".list");*/            
            if (tbl) {
                for (const currentRow of tbl.rows) {
                    currentRow.onclick = loadRow;
                }
            }
			console.log(a + " "  + b);
	}
</script>
</head>

<body>
	<h1>Stores</h1>
	<div class="list" name="list">List</div>
	<div class="record" name="record">Record</div>
	<button onclick="addEvents();"  >Add Events Now!!! </button>
	<h6>Updated 12/23 @ 1501</h6>
</body>
</html>